<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Service View â€“ IB Nueva Esperanza RVA</title>

<!-- ðŸ”’ Styles reused EXACTLY from Chart Editor -->
<style>
:root{
  --page-bg:#f7f8fa; --card-bg:#ffffff; --muted:#6b7280; --accent:#1f6feb;
  --generic-bg:#f8f9fa; --verse-bg:#f3fdf3; --chorus-bg:#eef6ff;
  --bridge-bg:#fffbea; --intro-bg:#f9f5ff; --interlude-bg:#faf5ff;
  --outro-bg:#f8f5f9; --medley-bg:#f9f5ff;
  --instrumental-bg:#f3fdfd; --solo-bg:#fff8f0;

  --generic-ac:#cfd8dc; --verse-ac:#81c784; --chorus-ac:#64b5f6;
  --bridge-ac:#f6d860; --intro-ac:#b39ddb; --interlude-ac:#ce93d8;
  --outro-ac:#b39ddb; --medley-ac:#ba68c8;
  --instrumental-ac:#4db6ac; --solo-ac:#ffb74d;

  --lyric-size:16px; --chord-size:17px; --section-title:16px;
  --meta-size:14px; --badge-font:12px;
  --title-size:32px; --subtitle-size:18px;
  --viewer-pad:24px; --column-gap:8mm;
}

html,body{
  margin:0;background:var(--page-bg);
  font-family:Georgia,"Times New Roman",serif;color:#111
}

.viewer{
  max-width:900px;
  margin:24px auto;
  padding:var(--viewer-pad);
  background:#fff;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}

.viewer.two-col{
  column-count:2;
  column-gap:var(--column-gap);
  column-fill:auto;
}

.header-box{
  border:1px solid #dce2ea;
  border-radius:12px;
  padding:14px 16px;
  margin-bottom:16px;
  column-span:all;
  text-align:center;
}

.title{font-size:var(--title-size);font-weight:800}
.subtitle{font-size:var(--subtitle-size);font-style:italic;color:var(--muted)}

.header-badges{
  display:flex;justify-content:center;flex-wrap:wrap;
  gap:10px;margin-top:10px
}

.header-badge{
  min-width:26px;height:26px;border-radius:50%;
  border:2px solid var(--generic-ac);
  display:flex;align-items:center;justify-content:center;
  font-size:var(--badge-font);font-weight:800
}

.section-box{
  border:1px solid #dce2ea;
  border-radius:12px;
  margin:12px 0;
  break-inside:avoid;
}

.section-head{
  position:relative;padding:16px 16px 4px 16px;
}

.section-title{
  font-family:system-ui;
  font-weight:700;color:#1f6feb;
  font-size:var(--section-title)
}

.section-badge{
  position:absolute;top:-10px;left:16px;
  width:26px;height:26px;border-radius:50%;
  border:2px solid var(--generic-ac);
  background:#fff;
  font-size:var(--badge-font);font-weight:800;
  display:flex;align-items:center;justify-content:center
}

.section-line{
  position:absolute;top:0;left:52px;right:16px;
  height:2px;background:var(--generic-ac)
}

.section-body{padding:0 16px 8px 16px}

pre{
  font-family:"Courier New",monospace;
  font-size:var(--lyric-size);
  line-height:1.25;margin:2px 0
}

.chord-strong{font-weight:700;font-size:var(--chord-size)}
</style>
</head>

<body>

<div id="serviceOutput" class="viewer two-col"></div>

<!-- ðŸ”‘ Decompression support -->
<script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

<script>
/* ==========================================================
   EXACT RENDERER (copied, not modified)
========================================================== */

const esc=s=>(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

function renderLineTwoRow(l){
  let lyric='',segs=[],acc='',inch=false,len=0;
  for(let i=0;i<l.length;i++){
    const ch=l[i];
    if(ch==='['){inch=true;acc='';}
    else if(ch===']'){
      inch=false;
      const pad=lyric.length-len;
      if(pad>0) segs.push({t:'s',l:pad});
      segs.push({t:'c',x:acc});
      len+=(pad>0?pad:0)+acc.length;
    }else if(inch){acc+=ch;}
    else{lyric+=ch;}
  }
  let out='';
  for(const s of segs){
    out+=s.t==='s'?' '.repeat(s.l):`<span class="chord-strong">${esc(s.x)}</span>`;
  }
  if(out.trim()) return `<pre>${out}\n${esc(lyric)}</pre>`;
  if(lyric.trim()) return `<pre>${esc(lyric)}</pre>`;
  return '';
}

function renderSong(chordPro){
  const lines=chordPro.split('\n');
  let html='';

  for(const line of lines){
    if(line.startsWith('{title:')){
      html+=`<div class="header-box">
        <div class="title">${esc(line.replace('{title:','').replace('}',''))}</div>
      </div>`;
      continue;
    }
    if(line.trim()==='') continue;
    html+=renderLineTwoRow(line);
  }
  return html;
}

/* ==========================================================
   SERVICE SET LOADER
========================================================== */

(function(){
  const params=new URLSearchParams(location.search);
  const set=params.get('set');
  if(!set){
    document.getElementById('serviceOutput').innerHTML=
      '<p style="color:#888;text-align:center">No service set loaded</p>';
    return;
  }

  let decoded=LZString.decompressFromBase64(decodeURIComponent(set))||'';
  const songs=decoded.split('\n---\n'); // song separator

  let out='';
  songs.forEach(song=>{
    out+=renderSong(song);
  });

  document.getElementById('serviceOutput').innerHTML=out;
})();
</script>

</body>
</html>
